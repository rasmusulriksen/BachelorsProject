services:
  smtp4dev:
    image: rnwood/smtp4dev:v3
    restart: always
    ports:
      # Change the number before : to the port the web interface should be accessible on
      - '5000:80'
      # Change the number before : to the port the SMTP server should be accessible on
      - '25:25'
      # Change the number before : to the port the IMAP server should be accessible on
      - '143:143'
    volumes:
      # This is where smtp4dev stores the database
        - smtp4dev-data:/smtp4dev
    environment:
      #Specifies the URLs the web UI will use inside the container.
      - ServerOptions__Urls=http://*:80

      #Specifies the server hostname. Used in auto-generated TLS certificate if enabled.
      - ServerOptions__HostName=smtp4dev

  # Application Service
  email-template-api:
    image: email-template-api:latest  # Ensure you build this image or use a build context
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5001:80"  # Ensure there's no port conflict
    depends_on:
      - postgres
    networks:
      - my_network
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__DefaultConnection=Host=postgres;Database=messagequeue;Username=admin;Password=admin;

  # Dapr Sidecar for the email-template-api
  dapr:
    image: daprio/daprd:latest
    command: ["./daprd", "-app-id", "email-template-api", "-app-port", "80", "--components-path", "/components"]
    depends_on:
      - email-template-api
    networks:
      - my_network
    volumes:
      - ./components:/components

volumes:
  smtp4dev-data:

networks:
  my_network:
    driver: bridge